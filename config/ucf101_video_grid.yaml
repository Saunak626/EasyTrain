# UCF-101视频分类网格搜索配置
# 用于搜索最佳的视频模型和超参数组合

# 任务配置
task:
  tag: "video_classification"
  description: "UCF-101视频分类网格搜索"

# 训练配置
training:
  exp_name: "ucf101_grid_exp"
  save_model: true
  model_save_path: "models/video_model.pth"

# SwanLab配置
swanlab:
  project_name: "EasyTrain-Video-Grid"
  description: "UCF-101视频分类网格搜索实验"

# 数据配置
data:
  type: ucf101_video  # 使用新的视频帧数据集类型
  root: /home/swq/posec3d/data/ucf101  # 数据集根目录
  num_workers: 16      # 数据加载工作进程数
  params:
    clip_len: 16      # 每个视频片段的帧数
    # FPS采样配置（可选）
    sampling_mode: "random"  # 采样模式: "random"（默认）或 "fps"
    # target_fps: 8          # 目标采样帧率，仅在sampling_mode为"fps"时使用
    # original_fps: 16       # 原始视频帧率，默认16fps

# 模型配置（仅保留必要的基础参数）
# model:
#   params:
#     num_classes: 101  # UCF-101有101个动作类别

# 超参数配置（基础默认值，可被网格搜索和命令行覆盖）
hp:
  epochs: 1
  batch_size: 32  # 默认值，网格搜索时会被覆盖
  learning_rate: 0.0001  # 默认值，网格搜索时会被覆盖

# GPU配置
gpu:
  device_ids: 0 # "2,3"
  auto_select: true

# 多卡训练配置
multi_gpu:
  enabled: true
  strategy: "ddp"

# 模型选择配置
models_to_train:
  # 启用要训练的模型列表，注释掉不需要训练的模型
  # - "r3d_18"
  # - "mc3_18"
  # - "r2plus1d_18"
  # - "s3d"
  - "mvit_v1_b"
  # - "mvit_v2_s"
  # - "swin3d_b"
  # - "swin3d_s"
  # - "swin3d_t"

# ============================================================================
# 网格搜索配置（唯一的网格搜索空间定义）
# ============================================================================
# 说明：
# 1. 网格搜索空间：通过 grid_search.groups 定义，每组模型有自己的超参数搜索范围
# 2. 网格搜索控制参数（如 max_experiments, save_results 等）通过命令行传递：
#    python scripts/grid_search_unified.py --config config/ucf101_video_grid.yaml \
#           --max_experiments 100 --save_results --top_n 10
# 3. 固定参数（可选）：可通过 grid_search.fixed 定义在所有组合中保持不变的参数
# ============================================================================

grid_search:
  # 分组式搜索：每组模型有自己的超参数搜索范围
  groups:
    # 轻量级3D CNN模型组 - 使用统一batch_size
    light_3d_cnn:
      model.type: ["r3d_18", "mc3_18", "r2plus1d_18"]
      hp.batch_size: [64, 32, 32]  # 统一batch_size，会自动扩充为 [128, 128, 128]
      hp.learning_rate: [0.0001]  # 与ucf101_video.yaml一致
      optimizer.name: ["adamw"]
      optimizer.params.weight_decay: [0.01]
      scheduler.name: ["cosine"]  # 统一使用cosine调度器
      scheduler.params.T_max: [10]  # 与epochs一致
      scheduler.params.eta_min: [0.000001]
      loss.name: ["crossentropy"]
    
    # 复杂3D CNN模型组 - 单模型，多batch_size选择
    complex_3d_cnn:
      model.type: ["s3d"]
      hp.batch_size: [36]  # S3D模型较大，需要小batch_size
      hp.learning_rate: [0.0001]  # 与ucf101_video.yaml一致
      optimizer.name: ["adamw"]  # S3D用Adam即可
      optimizer.params.weight_decay: [0.01]  # 与ucf101_video.yaml一致
      scheduler.name: ["cosine"]  # 统一使用cosine调度器
      scheduler.params.T_max: [10]  # 与epochs一致
      scheduler.params.eta_min: [0.000001]
      loss.name: ["crossentropy"]
    
    # Transformer模型组 - 精确配对batch_size，统一使用cosine调度器
    transformer_models:
      model.type: ["mvit_v1_b", "mvit_v2_s"]
      hp.batch_size: [16, 12]  # 按顺序配对：mvit_v1_b用36，mvit_v2_s用32
      hp.learning_rate: [0.0001]  # 与ucf101_video.yaml一致
      optimizer.name: ["adamw"]  # Transformer首选AdamW
      optimizer.params.weight_decay: [0.01]  # 与ucf101_video.yaml一致
      scheduler.name: ["cosine"]  # 统一使用cosine调度器
      scheduler.params.T_max: [10]  # 与epochs一致
      scheduler.params.eta_min: [0.000001]
      loss.name: ["crossentropy"]
    
    # Swin3D模型组 - 精确配对batch_size，统一使用cosine调度器
    swin3d_models:
      model.type: ["swin3d_b", "swin3d_s", "swin3d_t"]
      hp.batch_size: [8, 8, 8]  # 按顺序配对：swin3d_b用4，swin3d_s用8，swin3d_t用16
      hp.learning_rate: [0.0001]  # 与ucf101_video.yaml一致
      optimizer.name: ["adamw"]  # Swin系列推荐AdamW
      optimizer.params.weight_decay: [0.01]  # 与ucf101_video.yaml一致
      scheduler.name: ["cosine"]  # 统一使用cosine调度器
      scheduler.params.T_max: [10]  # 与epochs一致
      scheduler.params.eta_min: [0.000001]
      loss.name: ["crossentropy"]
