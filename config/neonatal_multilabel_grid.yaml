# æ–°ç”Ÿå„¿å¤šæ ‡ç­¾è¡Œä¸ºè¯†åˆ«ç½‘æ ¼æœç´¢é…ç½®
# åŸºäºUCF101è§†é¢‘é…ç½®ï¼Œé€‚é…æ–°ç”Ÿå„¿å¤šæ ‡ç­¾æ•°æ®

# ä»»åŠ¡é…ç½®
task:
  tag: "video_classification" # ä½¿ç”¨è§†é¢‘åˆ†ç±»ä»»åŠ¡ç±»å‹
  description: "æ–°ç”Ÿå„¿å¤šæ ‡ç­¾è¡Œä¸ºè¯†åˆ«ç½‘æ ¼æœç´¢"

# è®­ç»ƒé…ç½®
training:
  exp_name: "neonatal_multilabel_exp"
  save_model: true
  model_save_path: "models/neonatal_multilabel_model.pth"

# SwanLabé…ç½®
swanlab:
  project_name: "EasyTrain-Neonatal-Multilabel"
  description: "æ–°ç”Ÿå„¿å¤šæ ‡ç­¾è¡Œä¸ºè¯†åˆ«ç½‘æ ¼æœç´¢å®éªŒ"

# æ•°æ®é…ç½®
data:
  type: neonatal_multilabel # ä½¿ç”¨æ–°çš„æ–°ç”Ÿå„¿å¤šæ ‡ç­¾æ•°æ®é›†ç±»å‹
  # root: /home/swq/Code/Neonate-Feeding-Assessment/data/cpu_processed/frames_segments  # æ•°æ®é›†æ ¹ç›®å½•
  num_workers: 12 # å‡å°‘å·¥ä½œè¿›ç¨‹æ•°ï¼Œé¿å…CPUå’Œå†…å­˜è¿‡è½½
  params:
    clip_len: 32 # æ¯ä¸ªè§†é¢‘ç‰‡æ®µçš„å¸§æ•°
    top_n_classes: 10 # åªä½¿ç”¨æ ·æœ¬æ•°é‡å‰7å¤šçš„ç±»åˆ«ï¼Œå‡å°‘ç¨€æœ‰ç±»åˆ«å¹²æ‰°
    stratified_split: true # å¯ç”¨åˆ†å±‚æŠ½æ ·ï¼Œç¡®ä¿è®­ç»ƒæµ‹è¯•é›†ç±»åˆ«åˆ†å¸ƒä¸€è‡´
    min_samples_per_class: 10 # ç±»åˆ«æœ€å°æ ·æœ¬æ•°é˜ˆå€¼

# # æ¨¡å‹é…ç½®ï¼ˆä»…ä¿ç•™å¿…è¦çš„åŸºç¡€å‚æ•°ï¼‰
# model:
#   params:
#     num_classes: 7  # ä½¿ç”¨ç­›é€‰åçš„ç±»åˆ«æ•°é‡ï¼ˆä¸top_n_classesä¿æŒä¸€è‡´ï¼‰

# è¶…å‚æ•°é…ç½®ï¼ˆåŸºç¡€é»˜è®¤å€¼ï¼Œå¯è¢«ç½‘æ ¼æœç´¢å’Œå‘½ä»¤è¡Œè¦†ç›–ï¼‰
hp:
  epochs: 10

# GPUé…ç½®
gpu:
  device_ids: "2" # "2,3"
  auto_select: true

# å¤šå¡è®­ç»ƒé…ç½®
multi_gpu:
  enabled: true
  strategy: "ddp"

# æ¨¡å‹é€‰æ‹©é…ç½®
models_to_train:
  # å¯ç”¨è¦è®­ç»ƒçš„æ¨¡å‹åˆ—è¡¨ï¼Œæ³¨é‡Šæ‰ä¸éœ€è¦è®­ç»ƒçš„æ¨¡å‹
  - "r3d_18"
  - "mc3_18"
  - "r2plus1d_18"
  # - "mvit_v1_b"
  # - "mvit_v2_s"
  # - "swin3d_b"
  # - "swin3d_s"
  # - "swin3d_t"

# ç½‘æ ¼æœç´¢è®¾ç½®
max_experiments: 50
continue_on_error: true
parallel_jobs: 1
save_results: true
# results_file: "neonatal_multilabel_grid_search_results.csv"  # æ³¨é‡Šæ‰ä»¥ä½¿ç”¨æ—¶é—´æˆ³æ–‡ä»¶å

# ç½‘æ ¼æœç´¢è¶…å‚æ•° - åˆ†ç»„å¼é…ç½®
grid_search:
  # åˆ†ç»„å¼æœç´¢ï¼šæ¯ç»„æ¨¡å‹æœ‰è‡ªå·±çš„è¶…å‚æ•°æœç´¢èŒƒå›´
  groups:
    # è½»é‡çº§3D CNNæ¨¡å‹ç»„ - ä½¿ç”¨æ›´å¤§çš„batch_size
    # ğŸ”§ è°ƒåº¦å™¨é€‰é¡¹è¯´æ˜ï¼ˆå·²ä¼˜åŒ–å­¦ä¹ ç‡è¡°å‡å‚æ•°ï¼‰ï¼š
    # - "step": å›ºå®šé—´éš”é™ä½å­¦ä¹ ç‡ï¼Œå‚æ•°ï¼šstep_size, gammaï¼ˆæ¨èï¼šstep_size=3-5, gamma=0.8-0.9ï¼‰
    # - "cosine": ä½™å¼¦é€€ç«ï¼Œå‚æ•°ï¼šeta_min_factorï¼ˆæ¨èï¼š0.3-0.5ï¼Œé¿å…è¿‡ä½çš„æœ€å°å­¦ä¹ ç‡ï¼‰
    # - "plateau": åŸºäºéªŒè¯æŸå¤±è‡ªé€‚åº”ï¼Œå‚æ•°ï¼šfactor, patience, mode
    # - "warmup_cosine": Warmup+ä½™å¼¦é€€ç«ï¼Œå‚æ•°ï¼šwarmup_epochs, warmup_start_factor, eta_min_factor
    #   âš ï¸ æ³¨æ„ï¼šeta_min_factorä¸è¦è®¾ç½®è¿‡ä½ï¼ˆå¦‚0.01ï¼‰ï¼Œå»ºè®®0.3-0.5
    # - "linear": çº¿æ€§è¡°å‡ï¼Œå‚æ•°ï¼šstart_factor, end_factor
    # - "multistep": å¤šé˜¶æ®µè¡°å‡ï¼Œå‚æ•°ï¼šmilestones, gamma
    # - "exponential": æŒ‡æ•°è¡°å‡ï¼Œå‚æ•°ï¼šgamma
    light_3d_cnn:
      model.type: ["r3d_18", "mc3_18", "r2plus1d_18"]
      hp.batch_size: [36] # é™ä½batch_sizeä»¥å‡å°‘å†…å­˜å ç”¨å’ŒI/Oå‹åŠ›(å¤šå¡è®­ç»ƒæ—¶å…¨å±€batch=64)
      hp.learning_rate: [0.001] # æé«˜å­¦ä¹ ç‡ï¼ŒåŠ å¿«æ”¶æ•›
      optimizer.name: ["adamw"]
      optimizer.params.weight_decay: [0.01]
      scheduler.name: ["warmup_cosine"] # ğŸ”§ å¢åŠ æ›´å¤šè°ƒåº¦å™¨é€‰é¡¹
      scheduler.params.warmup_epochs: [2] # ğŸ”§ å¢åŠ WarmupæœŸé•¿åº¦ï¼š2ä¸ªepoch
      scheduler.params.warmup_start_factor: [1] # Warmupèµ·å§‹å­¦ä¹ ç‡æ¯”ä¾‹
      scheduler.params.eta_min_factor: [0.05] # ğŸ”§ è°ƒæ•´æœ€å°å­¦ä¹ ç‡ï¼š30%æˆ–50%ï¼ˆåŸæ¥1%å¤ªä½ï¼‰
      scheduler.params.step_size: [3] # æ¯3æˆ–5ä¸ªepoché™ä½å­¦ä¹ ç‡
      scheduler.params.gamma: [0.9] # ğŸ”§ æ›´æ¸©å’Œçš„å­¦ä¹ ç‡è¡°å‡å› å­
      loss.name: ["focal_multilabel_bce"] # "multilabel_bce", "focal_multilabel_balanced",  å¤šæ ‡ç­¾äºŒå…ƒäº¤å‰ç†µæŸå¤±
      loss.params.pos_weight: [10.0] # æ­£æ ·æœ¬æƒé‡ï¼Œå¤„ç†ç±»åˆ«ä¸å¹³è¡¡

    # Transformeræ¨¡å‹ç»„ - ç²¾ç¡®é…å¯¹batch_sizeï¼Œä½¿ç”¨Warmup + Cosineè°ƒåº¦ç­–ç•¥
    transformer_models:
      model.type: ["mvit_v1_b", "mvit_v2_s"]
      hp.batch_size: [36, 32] # æŒ‰é¡ºåºé…å¯¹ï¼šmvit_v1_bç”¨36ï¼Œmvit_v2_sç”¨32
      hp.learning_rate: [0.001] # é™ä½å­¦ä¹ ç‡ï¼Œæ›´ç¨³å®š
      optimizer.name: ["adamw"] # Transformeré¦–é€‰AdamW
      optimizer.params.weight_decay: [0.05] # é€‚ä¸­çš„æƒé‡è¡°å‡
      scheduler.name: ["warmup_cosine"] # ğŸ”§ å¢åŠ æ›´å¤šè°ƒåº¦å™¨é€‰é¡¹
      scheduler.params.warmup_epochs: [2] # ğŸ”§ å¢åŠ WarmupæœŸé•¿åº¦ï¼š2ä¸ªepoch
      scheduler.params.warmup_start_factor: [1] # Warmupèµ·å§‹å­¦ä¹ ç‡æ¯”ä¾‹
      scheduler.params.eta_min_factor: [0.05] # ğŸ”§ è°ƒæ•´æœ€å°å­¦ä¹ ç‡ï¼š30%æˆ–50%ï¼ˆåŸæ¥1%å¤ªä½ï¼‰
      scheduler.params.step_size: [3] # æ¯3æˆ–5ä¸ªepoché™ä½å­¦ä¹ ç‡
      scheduler.params.gamma: [0.9] # ğŸ”§ æ›´æ¸©å’Œçš„å­¦ä¹ ç‡è¡°å‡å› å­
      loss.name: ["focal_multilabel_bce"] # "multilabel_bce", "focal_multilabel_balanced",  å¤šæ ‡ç­¾äºŒå…ƒäº¤å‰ç†µæŸå¤±
      loss.params.pos_weight: [10.0, 20.0, 30.0] # æ­£æ ·æœ¬æƒé‡ï¼Œå¤„ç†ç±»åˆ«ä¸å¹³è¡¡

    # Swin3Dæ¨¡å‹ç»„ - ç²¾ç¡®é…å¯¹batch_sizeï¼Œä½¿ç”¨Warmup + Cosineè°ƒåº¦ç­–ç•¥
    swin3d_models:
      model.type: ["swin3d_b", "swin3d_s", "swin3d_t"]
      hp.batch_size: [16, 16, 16] # æŒ‰é¡ºåºé…å¯¹ï¼šswin3d_bç”¨4ï¼Œswin3d_sç”¨8ï¼Œswin3d_tç”¨16
      hp.learning_rate: [0.001] # ä¿å®ˆçš„å­¦ä¹ ç‡
      optimizer.name: ["adamw"] # Swinç³»åˆ—æ¨èAdamW
      optimizer.params.weight_decay: [0.05] # Swinç³»åˆ—ç”¨æ›´å¤§çš„weight_decay
      scheduler.name: ["warmup_cosine"] # ğŸ”§ å¢åŠ æ›´å¤šè°ƒåº¦å™¨é€‰é¡¹
      scheduler.params.warmup_epochs: [2] # ğŸ”§ å¢åŠ WarmupæœŸé•¿åº¦ï¼š2ä¸ªepoch
      scheduler.params.warmup_start_factor: [1] # Warmupèµ·å§‹å­¦ä¹ ç‡æ¯”ä¾‹
      scheduler.params.eta_min_factor: [0.05] # ğŸ”§ è°ƒæ•´æœ€å°å­¦ä¹ ç‡ï¼š30%æˆ–50%ï¼ˆåŸæ¥1%å¤ªä½ï¼‰
      scheduler.params.step_size: [3] # æ¯3æˆ–5ä¸ªepoché™ä½å­¦ä¹ ç‡
      scheduler.params.gamma: [0.9] # ğŸ”§ æ›´æ¸©å’Œçš„å­¦ä¹ ç‡è¡°å‡å› å­
      loss.name: ["focal_multilabel_bce"] # "multilabel_bce", "focal_multilabel_balanced",  å¤šæ ‡ç­¾äºŒå…ƒäº¤å‰ç†µæŸå¤±
      loss.params.pos_weight: [10.0, 20.0, 30.0] # æ­£æ ·æœ¬æƒé‡ï¼Œå¤„ç†ç±»åˆ«ä¸å¹³è¡¡

# è¯„ä¼°æŒ‡æ ‡é…ç½®ï¼ˆæš‚æ—¶æ³¨é‡Šæ‰ï¼Œä½¿ç”¨é»˜è®¤æŒ‡æ ‡ï¼‰
# metrics:
#   - name: multilabel_accuracy
#   - name: multilabel_f1
#   - name: multilabel_precision
#   - name: multilabel_recall

# æ—¥å¿—å’Œä¿å­˜é…ç½®
# logging:
#   log_level: INFO
#   save_model: true
#   save_best_only: true
#   monitor_metric: "val_accuracy"  # ä½¿ç”¨é»˜è®¤çš„å‡†ç¡®ç‡æŒ‡æ ‡
#   monitor_mode: "max"

# # æ•°æ®é‡‡æ ·é…ç½®ï¼ˆç”¨äºå¿«é€Ÿæµ‹è¯•ï¼‰
# sampling:
#   train_percentage: 1.0    # è®­ç»ƒæ•°æ®ä½¿ç”¨æ¯”ä¾‹
#   val_percentage: 1.0      # éªŒè¯æ•°æ®ä½¿ç”¨æ¯”ä¾‹

# # ç¯å¢ƒé…ç½®
# environment:
#   cuda_visible_devices: "2,3"  # æŒ‡å®šä½¿ç”¨çš„GPU
#   mixed_precision: false       # æ˜¯å¦ä½¿ç”¨æ··åˆç²¾åº¦è®­ç»ƒ
#   deterministic: true          # ç¡®å®šæ€§è®­ç»ƒ
#   seed: 42                     # éšæœºç§å­

# è¾“å‡ºé…ç½®
output:
  results_dir: "runs"
  experiment_name: "neonatal_multilabel_behavior"
  save_predictions: true
  save_confusion_matrix: true
