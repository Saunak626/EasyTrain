# tqdmè¿›åº¦æ¡ä¸ç»“æ„åŒ–æ•°æ®è®°å½•å®ç°æ€»ç»“

## ğŸ¯ é—®é¢˜è§£å†³

æˆåŠŸè§£å†³äº†åœ¨ä½¿ç”¨tqdmè¿›åº¦æ¡çš„æƒ…å†µä¸‹å¦‚ä½•æ­£ç¡®æ˜¾ç¤ºå’Œè®°å½•è®­ç»ƒç»“æœç»Ÿè®¡çš„é—®é¢˜ã€‚

### åŸå§‹é—®é¢˜
- ç½‘æ ¼æœç´¢ä¸­tqdmè¿›åº¦æ¡ä¸ç»“æœç»Ÿè®¡å­˜åœ¨å†²çª
- çˆ¶è¿›ç¨‹éš¾ä»¥å‡†ç¡®è§£æå­è¿›ç¨‹çš„è®­ç»ƒç»“æœ
- éœ€è¦åœ¨ä¿æŒtqdmä¸€è¡Œåˆ·æ–°æ•ˆæœçš„åŒæ—¶è®°å½•ç»“æ„åŒ–æ•°æ®

### è§£å†³æ–¹æ¡ˆ
å®ç°äº†åŒè½¨åˆ¶çš„è¾“å‡ºæœºåˆ¶ï¼š
1. **é¢å‘äººç±»**ï¼štqdmè¿›åº¦æ¡ + tqdm.write()æ‘˜è¦è¾“å‡º
2. **é¢å‘ç¨‹åº**ï¼šç»“æ„åŒ–æ–‡ä»¶ + æœºå™¨å¯è¯»è¾“å‡ºè¡Œ

## ğŸš€ æ ¸å¿ƒå®ç°

### 1. è®­ç»ƒè„šæœ¬æ”¹è¿› (src/trainers/base_trainer.py)

#### æ–°å¢åŠŸèƒ½
- **ç»“æ„åŒ–æ•°æ®è®°å½•å‡½æ•°**ï¼š
  - `write_epoch_metrics()` - å†™å…¥epochçº§åˆ«æŒ‡æ ‡åˆ°JSONL
  - `write_final_result()` - å†™å…¥æœ€ç»ˆç»“æœåˆ°JSON

- **æ”¹è¿›çš„è¿›åº¦æ¡æ˜¾ç¤º**ï¼š
  ```python
  # è®­ç»ƒè¿›åº¦æ¡ - å®æ—¶æ˜¾ç¤ºlosså’Œå­¦ä¹ ç‡
  progress_bar.set_postfix(loss=f"{avg_loss:.4f}", lr=f"{current_lr:.2e}")
  
  # æµ‹è¯•ç»“æœæ‘˜è¦ - ä½¿ç”¨tqdm.write()ä¸ç ´åè¿›åº¦æ¡
  tqdm.write(f'Epoch {epoch:03d} | val_loss={avg_loss:.4f} | val_acc={accuracy:.2f}%')
  ```

- **æœºå™¨å¯è¯»è¾“å‡º**ï¼š
  ```python
  # è¾“å‡ºå¸¦å‰ç¼€çš„JSONè¡Œä¾›çˆ¶è¿›ç¨‹è§£æ
  print("##RESULT## " + json.dumps({"best_accuracy": best_accuracy}))
  ```

#### æ–‡ä»¶ç»“æ„
```
runs/
â”œâ”€â”€ <experiment_name>/
â”‚   â”œâ”€â”€ metrics.jsonl    # æ¯epochçš„è¯¦ç»†æŒ‡æ ‡
â”‚   â””â”€â”€ result.json      # æœ€ç»ˆå®éªŒç»“æœ
```

#### æ•°æ®æ ¼å¼
**metrics.jsonl** (æ¯è¡Œä¸€ä¸ªJSONå¯¹è±¡):
```json
{"event": "epoch_end", "epoch": 1, "train_loss": 1.068, "val_loss": 0.640, "val_acc": 77.40, "best_acc": 77.40, "timestamp": "2025-01-27T10:30:00"}
```

**result.json** (æœ€ç»ˆç»“æœ):
```json
{
  "experiment_name": "grid_001",
  "best_accuracy": 93.71,
  "final_accuracy": 93.71,
  "total_epochs": 5,
  "config": {...},
  "timestamp": "2025-01-27T10:35:00"
}
```

### 2. ç½‘æ ¼æœç´¢è„šæœ¬æ”¹è¿› (scripts/grid_search.py)

#### æ–°å¢åŠŸèƒ½
- **å¤šå±‚æ¬¡ç»“æœè§£æ**ï¼š
  1. ä¼˜å…ˆä»ç»“æ„åŒ–æ–‡ä»¶è¯»å– (`parse_result_from_files()`)
  2. å¤‡ç”¨ä»æ ‡å‡†è¾“å‡ºè§£æ (`parse_result_from_output()`)

- **æ™ºèƒ½è¾“å‡ºè¿‡æ»¤**ï¼š
  ```python
  # æ˜¾ç¤ºå…³é”®è®­ç»ƒä¿¡æ¯
  if any(keyword in line_content for keyword in [
      "è®­ç»ƒå®éªŒ:", "æ•°æ®é›†:", "æ¨¡å‹:", "å‚æ•°:", 
      "Epoch", "val_loss=", "val_acc=", "æ–°æœ€ä½³å‡†ç¡®ç‡:",
      "è®­ç»ƒå®Œæˆ!", "##RESULT##"
  ]):
      print(f"[{exp_name}] {line.rstrip()}")
  
  # æ˜¾ç¤ºtqdmè¿›åº¦æ¡
  elif ("Training:" in line_content or "Testing:" in line_content) and ("%" in line_content):
      print(f"\r[{exp_name}] {line.rstrip()}", end='', flush=True)
  ```

## ğŸ“Š æµ‹è¯•ç»“æœ

### âœ… åŠŸèƒ½éªŒè¯
1. **tqdmè¿›åº¦æ¡æ˜¾ç¤º** - æ­£å¸¸å·¥ä½œ âœ…
2. **epochæ‘˜è¦è¾“å‡º** - ä½¿ç”¨tqdm.write()ä¸ç ´åè¿›åº¦æ¡ âœ…
3. **ç»“æ„åŒ–æ•°æ®è®°å½•** - JSONLå’ŒJSONæ–‡ä»¶æ­£ç¡®ç”Ÿæˆ âœ…
4. **ç»“æœè§£æ** - ç½‘æ ¼æœç´¢èƒ½å‡†ç¡®è·å–è®­ç»ƒç»“æœ âœ…
5. **å¤šGPUå…¼å®¹** - åªæœ‰ä¸»è¿›ç¨‹å†™æ–‡ä»¶å’Œè¾“å‡º âœ…

### ğŸ“ˆ å®é™…è¿è¡Œç»“æœ
```bash
python scripts/grid_search.py --config config/grid.yaml --multi_gpu --max_experiments 5
```

**è¾“å‡ºæ•ˆæœ**ï¼š
```
ğŸš€ å¼€å§‹å®éªŒ 001: grid_001
ğŸ“‹ å‚æ•°: {'learning_rate': 0.001, 'batch_size': 64, 'dropout': 0.1, 'epochs': 5, 'model_type': 'resnet18'}
[grid_001] === è®­ç»ƒå®éªŒ: grid_001 ===
[grid_001] æ•°æ®é›†: cifar10
[grid_001] æ¨¡å‹: resnet18
[grid_001] Epoch 1/5
[grid_001] Epoch 001 | val_loss=0.6405 | val_acc=77.40%
[grid_001] æ–°æœ€ä½³å‡†ç¡®ç‡: 77.40%
...
[grid_001] è®­ç»ƒå®Œæˆ! æœ€ä½³å‡†ç¡®ç‡: 93.71%
âœ… å®éªŒ grid_001 å®Œæˆï¼Œæœ€ä½³å‡†ç¡®ç‡: 93.71%
```

**æœ€ç»ˆç»Ÿè®¡**ï¼š
```
âœ… æˆåŠŸå®éªŒ: 3/3

ğŸ† æœ€ä½³å®éªŒç»“æœ:
   å®éªŒåç§°: grid_001
   æœ€ä½³å‡†ç¡®ç‡: 93.71%
   æœ€ç»ˆå‡†ç¡®ç‡: 93.71%
   æœ€ä¼˜å‚æ•°:
     learning_rate: 0.001
     batch_size: 64
     dropout: 0.1
     epochs: 5
     model_type: resnet18
```

## ğŸ‰ æ ¸å¿ƒä¼˜åŠ¿

1. **ç”¨æˆ·ä½“éªŒä¼˜åŒ–**ï¼š
   - ä¿æŒtqdmè¿›åº¦æ¡çš„ä¸€è¡Œåˆ·æ–°æ•ˆæœ
   - æ¸…æ™°çš„epochæ‘˜è¦è¾“å‡º
   - å®æ—¶æ˜¾ç¤ºè®­ç»ƒæŒ‡æ ‡

2. **ç¨‹åºå…¼å®¹æ€§**ï¼š
   - å¯é çš„ç»“æ„åŒ–æ•°æ®æ¥å£
   - å¤šå±‚æ¬¡çš„ç»“æœè§£ææœºåˆ¶
   - å®Œå–„çš„é”™è¯¯å¤„ç†

3. **å¤šGPUæ”¯æŒ**ï¼š
   - åªæœ‰ä¸»è¿›ç¨‹è¾“å‡ºå’Œå†™æ–‡ä»¶
   - é¿å…é‡å¤æ˜¾ç¤ºå’Œæ–‡ä»¶å†²çª

4. **å¯æ‰©å±•æ€§**ï¼š
   - æ ‡å‡†åŒ–çš„æ•°æ®æ ¼å¼
   - æ˜“äºæ·»åŠ æ–°çš„æŒ‡æ ‡è®°å½•
   - æ”¯æŒå®æ—¶ç›‘æ§å’Œåˆ†æ

## ğŸ”§ ä½¿ç”¨æ–¹æ³•

### å•æ¬¡è®­ç»ƒ
```bash
python scripts/train.py --config config/grid.yaml --experiment_name test_run --epochs 5
```

### ç½‘æ ¼æœç´¢
```bash
python scripts/grid_search.py --config config/grid.yaml --multi_gpu --max_experiments 5
```

### ç»“æœæŸ¥çœ‹
```bash
# æŸ¥çœ‹ç»“æ„åŒ–ç»“æœ
cat runs/grid_001/result.json
cat runs/grid_001/metrics.jsonl

# æŸ¥çœ‹CSVæ±‡æ€»
cat grid_search_results/grid_search_results_*.csv
```

è¿™ä¸ªå®ç°å®Œç¾è§£å†³äº†tqdmè¿›åº¦æ¡ä¸ç»“æœç»Ÿè®¡çš„å†²çªé—®é¢˜ï¼Œæä¾›äº†æ—¢ç”¨æˆ·å‹å¥½åˆç¨‹åºå‹å¥½çš„è§£å†³æ–¹æ¡ˆï¼ğŸš€
